# ssh

[ssh](https://blog.csdn.net/weixin_40274679/article/details/108520756)

SSH 不仅仅能够自动加密和解密SSH客户端与服务端之间的网络数据，同时SSH 还提供了一个非常有用的功能，那就是端口转发，即 将TCP 端口的网络数据，转发到指定主机的某个端口上，在转发的同时会对数据进行相应的加密及解密。如果工作环境中的防火墙限制了一些网络端口的使用，但是允许SSH连接，那么也是能够通过使用SSH转发后的端口进行通信

SSH端口转发，主要分为本地转发与远程转发两种类型

本地转发, 由本地网络服务器的某个端口，转发到远程服务器某个端口
ssh -L 本地网卡地址:本地端口:目标地址:目标端口 用户@目标地址
将本地的3306端口，转发到192.168.13.142的3306端口
ssh -L 127.0.0.1:3306:127.0.0.1:3306 root@192.168.13.142

远程转发, 由远程服务器的某个端口，转发到本地网络的服务器某个端口
ssh -R 远程网卡地址:远程端口:目标地址:目标端口 远程用户@远程地址

SSH的远程操作
机器A(192.168.13.148)
机器B(192.168.13.149)

在机器A中查看机器B的操作系统类型
ssh root@192.168.13.149 'uname -a'

将机器A中test文件夹复制到B机器
tar -cz test | ssh root@192.168.13.149 'tar -xz'
也可以用scp 或则 rz 传输文件

在机器A上查看B机器是否监听了1080端口
ssh user@192.168.13.149 'netstat -tln | grep 1080'

假设A机器上面，启动了Nginx服务
希望B机器也能够这样使用A机器上面的服务。需要把B机器上面80端口请求，转发到A机器上面
在B机器上面，执行如下代码
ssh -f -N -L 127.0.0.1:80:192.168.13.148:80 user@192.168.13.148
在B机器 curl 127.0.0.1:80 访问A机器服务

上面的需求也可以使用远程转发实现
在A机器上面执行如下代码
ssh -f -N -R 8081:127.0.0.1:80 user@192.168.13.149
监听了B机器的 8081 端口，把该端口的请求，转发到A机器的80端口
在B机器 curl 127.0.0.1:8081 访问A机器服务

## 使用多个公钥

重启电脑后，如果遇到个人和公司的代码不能同时提交，且报下面的错误的话

Permission to liangjisheng/go-books.git denied to liangjishengzks

则在终端执行下这个命令，意思是把对应的私钥重新加入到 mac 的 keychain 服务中去

```shell
ssh-add -K /Users/liangjisheng/.ssh/id_rsa_liangjisheng
```
